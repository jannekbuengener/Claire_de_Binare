workflows:
  version: 2

  feature-branches:
    when:
      not:
        equal: [ main, << pipeline.git.branch >> ]
    jobs:
      - install-deps
      - lint:
          requires:
            - install-deps
      - unit-tests:
          requires:
            - install-deps

  main-branch:
    when:
      equal: [ main, << pipeline.git.branch >> ]
    jobs:
      - install-deps
      - lint:
          requires:
            - install-deps
      - unit-tests:
          requires:
            - install-deps
      - docker-compose-test:
          requires:
            - unit-tests

  tagged-release:
    when:
      matches:
        pattern: "^v[0-9]+\\.[0-9]+\\.[0-9]+$"
        value: << pipeline.git.tag >>
    jobs:
      - docker-compose-test
      # sp√§ter: build-and-push-images

