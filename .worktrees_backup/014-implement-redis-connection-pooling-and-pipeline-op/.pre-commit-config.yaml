# =============================================================================
# Claire de Binare - Pre-commit Hooks Configuration
# =============================================================================

repos:
  # SECRET SCANNING - CRITICAL (Blueprint-compliant)
  - repo: https://github.com/gitleaks/gitleaks
    rev: v8.18.1
    hooks:
      - id: gitleaks
        name: üîê Detect secrets with Gitleaks
  - repo: local
    hooks:
      - id: emoji-filter
        name: üö´ Emoji Filter
        entry: python .github/scripts/advanced-emoji-filter.py
        args: [--config, .github/emoji-config.yaml, --path, .]
        language: python
        additional_dependencies: [regex, emoji, pyyaml]
        files: \.(py|js|ts|jsx|tsx|java|cpp|c|cs|php|rb|go|rs)$
        exclude: ^(node_modules/|\.git/|__pycache__/|build/|dist/)
        
      - id: emoji-config-validator
        name: ‚öôÔ∏è Emoji Config Validator
        entry: python
        args: [-c, "
import yaml; 
import sys;
try:
    with open('.github/emoji-config.yaml') as f: 
        config = yaml.safe_load(f);
    required = ['detection', 'whitelist', 'actions'];
    missing = [k for k in required if k not in config];
    if missing:
        print(f'‚ùå Missing config sections: {missing}');
        sys.exit(1);
    print('‚úÖ Emoji config valid');
except Exception as e:
    print(f'‚ùå Config error: {e}');
    sys.exit(1);
"]
        language: python
        additional_dependencies: [pyyaml]
        files: \.github/emoji-config\.yaml$
        always_run: false
        
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: detect-private-key
        name: üîë Detect private keys
      - id: check-added-large-files
        args: ['--maxkb=500']
        name: üì¶ Check for large files
      - id: trailing-whitespace
        exclude: .*\.md$
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-json
      - id: check-merge-conflict
        name: üîÄ Check for merge conflicts
        
  # Optional: Weitere Code-Quality Hooks
  - repo: https://github.com/psf/black
    rev: 23.7.0
    hooks:
      - id: black
        args: [--line-length=88]
        
  - repo: https://github.com/pycqa/flake8
    rev: 6.0.0
    hooks:
      - id: flake8
        args: [--max-line-length=88, --extend-ignore=E203,W503]

  # Type Checking
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.8.0
    hooks:
      - id: mypy
        args: [--ignore-missing-imports, --no-strict-optional]
        additional_dependencies: [types-redis, types-requests]
        exclude: ^(tests/|\.venv/)

  # Conventional Commits
  - repo: https://github.com/compilerla/conventional-pre-commit
    rev: v3.1.0
    hooks:
      - id: conventional-pre-commit
        stages: [commit-msg]
        args: [--strict, feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert]