{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://claire-de-binare.local/schemas/alert.schema.json",
  "title": "AlertEvent",
  "description": "System or risk alert published by Risk Manager or Execution Service, consumed by Dashboard and Notification services",
  "type": "object",
  "required": [
    "type",
    "level",
    "code",
    "message",
    "timestamp"
  ],
  "properties": {
    "type": {
      "type": "string",
      "const": "alert",
      "description": "Event type identifier"
    },
    "level": {
      "type": "string",
      "enum": ["CRITICAL", "WARNING", "INFO"],
      "description": "Alert severity level"
    },
    "code": {
      "type": "string",
      "enum": [
        "RISK_LIMIT",
        "CIRCUIT_BREAKER",
        "DATA_STALE",
        "DRAWDOWN_LIMIT_HIT",
        "EXPOSURE_LIMIT_REACHED",
        "POSITION_SIZE_EXCEEDED",
        "STOP_LOSS_TRIGGERED",
        "HIGH_SLIPPAGE",
        "MARKET_ANOMALY",
        "SERVICE_UNAVAILABLE",
        "CONNECTION_ERROR",
        "SYSTEM_ERROR"
      ],
      "description": "Alert code for categorization and automated handling"
    },
    "message": {
      "type": "string",
      "minLength": 1,
      "maxLength": 500,
      "description": "Human-readable alert message",
      "examples": [
        "Daily drawdown limit exceeded: 5.2%",
        "Trading halted. Manual intervention required.",
        "High slippage detected: 1.8%",
        "No market data for 35s"
      ]
    },
    "timestamp": {
      "type": "integer",
      "minimum": 1000000000000,
      "description": "Unix timestamp in milliseconds when alert was generated"
    },
    "symbol": {
      "type": "string",
      "pattern": "^[A-Z0-9]+_[A-Z]+$",
      "description": "Related trading pair symbol (if applicable)",
      "examples": ["BTC_USDT", "ETH_USDT"]
    },
    "service": {
      "type": "string",
      "description": "Name of the service that generated the alert",
      "examples": ["risk_manager", "execution_service", "signal_engine"]
    },
    "details": {
      "type": "object",
      "description": "Additional contextual information about the alert",
      "properties": {
        "current_value": {
          "type": "number",
          "description": "Current value that triggered the alert"
        },
        "threshold": {
          "type": "number",
          "description": "Threshold that was exceeded"
        },
        "unit": {
          "type": "string",
          "description": "Unit of measurement (%, USDT, etc.)"
        }
      }
    },
    "action_required": {
      "type": "boolean",
      "default": false,
      "description": "Whether manual intervention is required"
    },
    "auto_resolved": {
      "type": "boolean",
      "default": false,
      "description": "Whether the alert condition has been automatically resolved"
    }
  },
  "additionalProperties": false,
  "allOf": [
    {
      "if": {
        "properties": {
          "level": {
            "const": "CRITICAL"
          }
        }
      },
      "then": {
        "properties": {
          "action_required": {
            "const": true
          }
        }
      }
    }
  ]
}
